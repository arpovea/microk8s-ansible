---
- name: Create Argo CD namespace
  kubernetes.core.k8s:
    state: present
    definition:
      apiVersion: v1
      kind: Namespace
      metadata:
        name: argocd
  ignore_errors: true
  register: ignore_errors_register
  become: true

- name: Download Argo CD manifest
  ansible.builtin.get_url:
    url: "https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml"
    dest: "/tmp/argocd-install.yaml"
    mode: '0644'
  become: true

- name: Apply Argo CD manifest
  kubernetes.core.k8s:
    state: present
    src: "/tmp/argocd-install.yaml"
    namespace: argocd
  become: true
